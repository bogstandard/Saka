!function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e){var n,r=[[255,171,171],[255,218,171],[221,255,171],[171,228,255],[217,171,255],[27,27,27],[255,255,255],[248,236,201],[175,220,200],[240,135,129]],a=4,o=r[5],i=.75,c=0,d=d3.line().curve(d3.curveBasis),u=d3.select("svg").attr("viewBox","0 0 "+window.innerWidth+" "+window.innerHeight).attr("initwidth",window.innerWidth).attr("initheight",window.innerHeight),s=u.append("g");if(b(),bucketdata.editable||function t(){setTimeout(function(){fetch("/!fetch-drawing",{method:"POST",body:JSON.stringify(bucketdata),credentials:"same-origin",headers:new Headers({"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":bucketdata._token})}).then(function(t){return t.json()}).catch(function(t){return console.error("Error:",t)}).then(function(e){if(e.error)console.log("Error:",e.error);else{var n=JSON.parse(e.lines);bucketdata.lines!=n&&(bucketdata.lines=n),b(),t()}})},1e4)}(),bucketdata.editable){var f=u.append("circle").attr("class","nib").attr("cy",0).attr("cx",0).attr("r",a).attr("fill","rgba("+o[0]+", "+o[1]+", "+o[2]+", "+(i-.2)+")").attr("stroke","rgb("+o[0]+", "+o[1]+", "+o[2]+")"),p=0;u.append("g").selectAll("circle").data(r).enter().append("circle").attr("class","palette-circle").attr("cy",function(){return++p%2==0?20:30}).attr("cx",function(){return 20*p--}).attr("r",10).attr("stroke","black").attr("fill",function(t){return"rgb("+t[0]+", "+t[1]+", "+t[2]+")"}).on("click",function(t){o=t,f.attr("fill","rgba("+o[0]+", "+o[1]+", "+o[2]+", "+i),f.attr("stroke","rgba("+o[0]+", "+o[1]+", "+o[2]+", "+i)});u.call(d3.drag().container(function(){return this}).subject(function(){var t=[d3.event.x,d3.event.y,a,o,i];return[t,t]}).on("start",function(){var t=d3.event.subject,e=d3.event.x,r=d3.event.y;(n=s.append("path").datum(t)).attr("id","line_"+ ++c),d3.event.on("drag",function(){var c=d3.event.x,u=d3.event.y,s=c-e,l=u-r;f.attr("cx",d3.event.x).attr("cy",d3.event.y),s*s+l*l>10?t.push([e=c,r=u,a,o,i]):t[t.length-1]=[c,u,a,o,i],n.attr("d",d).attr("stroke-width",2*a).attr("stroke","rgba("+o[0]+", "+o[1]+", "+o[2]+", "+i)})}).on("end",function(){n=null,k()})).on("mousemove",function(){var t=d3.mouse(this);f.attr("cx",t[0]).attr("cy",t[1])}),document.onkeydown=function(t){"38"==(t=t||window.event).keyCode?(a+=5,h()):"40"==t.keyCode?(a-=5,h()):"37"==t.keyCode?(i-=.05)<.1&&(i=.1):"39"==t.keyCode?(i+=.05)>1&&(i=1):"27"==t.keyCode&&(s.select("#line_"+c--).remove(),k())}}function h(){a<0&&(a=1),f.transition().duration(500).attr("r",a),n&&n.transition().duration(500).attr("stroke-width",a)}function b(){bucketdata.lines.forEach(function(t){l=s.append("path").datum(t),dt=t[0],l.attr("d",d).attr("stroke-width",2*dt[2]).attr("stroke","rgba("+dt[3][0]+", "+dt[3][1]+", "+dt[3][2]+", "+dt[4])})}function k(){bucketdata.lines=u.selectAll("path").data(),bucketdata.width=window.innerWidth,bucketdata.height=window.innerHeight,bucketdata.lines=bucketdata.lines.map(function(t){return t.map(function(t,e){return 0===e?t:[t[0],t[1]]})}),fetch("/!make-drawing",{method:"POST",body:JSON.stringify(bucketdata),credentials:"same-origin",headers:new Headers({"Content-Type":"application/json",Accept:"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":bucketdata._token})}).then(function(t){return t.json()}).catch(function(t){return console.error("Error:",t)}).then(function(t){t.error?console.log("Error:",t.error):(bucketdata=t,document.querySelector("#metadata .saved").textContent=Date(t.saved).toLocaleString())})}window.toggleHidden=function(t){document.querySelectorAll(".modal").forEach(function(e){"#"+e.id!=t&&e.classList.add("hidden")}),(t=document.querySelector(t)).classList.toggle("hidden")}}]);